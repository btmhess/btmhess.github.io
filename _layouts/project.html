---
layout: default
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }} | My Projects Portfolio</title>
  <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>

<header>
  <nav>
    <div>
      <a href="/">Home</a>
      <a href="/index.html">Projects</a>
    </div>
    <h1>{{ page.title }}</h1>
  </nav>
</header>

<main>

  <!-- Banner image (manual thumbnail preferred) -->
  <div id="banner" style="text-align:center; margin-bottom:1rem;">
    <img id="banner-img" src="/assets/projects/{{ page.project_slug }}/thumbnail.png" 
         alt="{{ page.title }} banner" style="max-width:100%; border-radius:4px;">
  </div>

  <!-- Project metadata -->
  <section>
    <p><strong>Goal:</strong> {{ page.goal }}</p>
    <h2>Requirements</h2>
    <p>{{ page.requirements }}</p>
    <h2>Result / Current Incarnation</h2>
    <p>{{ page.result }}</p>
    <h2>Specifications</h2>
    <p>{{ page.specifications }}</p>
  </section>

  <!-- Gallery (excluding thumbnail/banner) -->
  <h2>Gallery</h2>
  <div id="gallery">
    <em>Loading gallery…</em>
  </div>

  <!-- Materials table -->
  <h2>Materials / Parts List</h2>
  <div id="materials-table">
    <em>Loading materials list…</em>
  </div>

  <!-- Related projects -->
  {% if page.related %}
    <h2>Related Projects</h2>
    <ul>
      {% for r in page.related %}
        <li><a href="{{ r.url }}">{{ r.title }}</a></li>
      {% endfor %}
    </ul>
  {% endif %}

</main>

<script>
// --- Gallery loader (excludes manual thumbnail/banner) ---
(function() {
  const galleryContainer = document.getElementById("gallery");
  const projectSlug = "{{ page.project_slug }}";
  const folder = "/assets/projects/" + projectSlug + "/";

  // Liquid-generated array of images in the folder
  const images = [
    {% assign project_folder = "assets/projects/" | append: page.project_slug | append: "/" %}
    {% assign project_images = site.static_files | where_exp: "f", "f.path contains project_folder" | sort: "path" %}
    {% for file in project_images %}
      {% if file.extname == ".jpg" or file.extname == ".jpeg" or file.extname == ".png" or file.extname == ".webp" %}
        "{{ file.name }}"{% unless forloop.last %},{% endunless %}
      {% endif %}
    {% endfor %}
  ];

  // Remove thumbnail.png from gallery if it exists
  const filteredImages = images.filter(name => name != "thumbnail.png");

  if (filteredImages.length === 0) {
    galleryContainer.innerHTML = "<em>No additional images available.</em>";
    return;
  }

  // Display gallery images
  galleryContainer.innerHTML = "";
  filteredImages.forEach(imgName => {
    const img = document.createElement("img");
    img.src = folder + imgName;
    img.alt = imgName;
    galleryContainer.appendChild(img);
  });
})();

// --- Materials CSV loader ---
(async function () {
  const container = document.getElementById("materials-table");
  const projectSlug = "{{ page.project_slug }}";
  const csvUrl = "/assets/projects/" + projectSlug + "/materials.csv";

  try {
    const response = await fetch(csvUrl);
    if (!response.ok) throw new Error("No materials.csv found");

    const text = await response.text();
    const rows = text.trim().split("\n").map(r => r.split(","));

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    // Header
    const headerRow = document.createElement("tr");
    rows[0].forEach(h => {
      const th = document.createElement("th");
      th.textContent = h.trim();
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    // Body
    rows.slice(1).forEach(row => {
      const tr = document.createElement("tr");
      row.forEach(cell => {
        const td = document.createElement("td");
        td.textContent = cell.trim();
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);

    container.innerHTML = "";
    container.appendChild(table);
  } catch (err) {
    container.innerHTML = "<em>No materials list available.</em>";
    console.warn("Materials table load failed:", err);
  }
})();
</script>

</body>
</html>
