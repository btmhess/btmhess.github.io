---
layout: default
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }} | Projects Portfolio</title>
  <link rel="stylesheet" href="/assets/css/style.css">
</head>

<body class="project-page">

<header>
  <nav>
    <div>
      <a href="/">Home</a>
    </div>
    <h1>{{ page.title }}</h1>
  </nav>
</header>

<main>

  <!-- Banner image -->
  <div id="banner">
    <img src="/assets/projects/{{ page.project_slug }}/thumbnail.png" 
         alt="{{ page.title }} banner">
  </div>

  <!-- Project metadata -->
  <div>
   <span><h2>{{ page.title }}</h2></span>
    <span><strong>Date:</strong> {{ page.project_date }}</span> |
    <span><strong>Status:</strong> {{ page.status }}</span> |
    <span><strong>Budget:</strong> ${{ page.budget }}</span>
  </div>
  
  <section>
    <h2>Goal</h2>
	<p>{{ page.goal }}</p>
    <h2>Requirements</h2>
    <p>{{ page.requirements }}</p>
    <h2>Result / Current Incarnation</h2>
    <p>{{ page.result }}</p>
    <h2>Specifications</h2>
    <p>{{ page.specifications }}</p>
  </section>
  
  {% if page.related %}
    <h2>Related Projects</h2>
      {% for slug in page.related_projects %}
      {% assign related = site.projects | where: "project_slug", slug | first %}
      {% if related %}
        <a href="{{ related.url }}">{{ related.title }}</a>{% unless forloop.last %}, {% endunless %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- Gallery -->
  <h2>Gallery</h2>
  <div id="gallery"></div>

  <!-- Materials -->
  <h2>Materials / Parts List</h2>
  <div id="materials-table"></div>
  
</main>

<!-- Lightbox overlay -->
<div id="lightbox-overlay">
  <img id="lightbox-img" src="" alt="Gallery image">
  <div id="lightbox-controls">
    <button id="prev-btn">&larr; Prev</button>
    <button id="next-btn">Next &rarr;</button>
    <button id="close-btn">Close</button>
  </div>
</div>

<script>
// Gallery + lightbox
(function() {
  const galleryContainer = document.getElementById("gallery");
  const projectSlug = "{{ page.project_slug }}";
  const folder = "/assets/projects/" + projectSlug + "/";
  const images = [
    {% assign project_folder = "assets/projects/" | append: page.project_slug | append: "/" %}
    {% assign project_images = site.static_files | where_exp: "f", "f.path contains project_folder" | sort: "path" %}
    {% for file in project_images %}
      {% if file.extname == ".jpg" or file.extname == ".jpeg" or file.extname == ".png" or file.extname == ".webp" %}
        "{{ file.name }}"{% unless forloop.last %},{% endunless %}
      {% endif %}
    {% endfor %}
  ];

  const galleryImages = images.filter(name => name !== "thumbnail.png");
  galleryContainer.innerHTML = "";

  galleryImages.forEach((imgName, index) => {
    const img = document.createElement("img");
    img.src = folder + imgName;
    img.alt = imgName;
    img.dataset.index = index;
    galleryContainer.appendChild(img);
  });

  // Lightbox
  const overlay = document.getElementById("lightbox-overlay");
  const lightboxImg = document.getElementById("lightbox-img");
  const prevBtn = document.getElementById("prev-btn");
  const nextBtn = document.getElementById("next-btn");
  const closeBtn = document.getElementById("close-btn");

  let currentIndex = 0;

  function openLightbox(index) {
    currentIndex = index;
    lightboxImg.src = folder + galleryImages[currentIndex];
    overlay.style.display = "flex";
  }

  function closeLightbox() { overlay.style.display = "none"; }
  function showNext() { currentIndex = (currentIndex+1)%galleryImages.length; lightboxImg.src = folder + galleryImages[currentIndex]; }
  function showPrev() { currentIndex = (currentIndex-1+galleryImages.length)%galleryImages.length; lightboxImg.src = folder + galleryImages[currentIndex]; }

  galleryContainer.querySelectorAll("img").forEach(img => {
    img.addEventListener("click", () => openLightbox(parseInt(img.dataset.index)));
  });

  prevBtn.addEventListener("click", showPrev);
  nextBtn.addEventListener("click", showNext);
  closeBtn.addEventListener("click", closeLightbox);
  overlay.addEventListener("click", e => { if(e.target===overlay) closeLightbox(); });
})();
</script>

<script>
// Materials CSV loader
(async function () {
  const container = document.getElementById("materials-table");
  const projectSlug = "{{ page.project_slug }}";
  const csvUrl = "/assets/projects/" + projectSlug + "/materials.csv";

  try {
    const response = await fetch(csvUrl);
    if (!response.ok) throw new Error("No materials.csv found");

    const text = await response.text();
    const rows = text.trim().split("\n").map(r => r.split(","));

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    const headerRow = document.createElement("tr");
    rows[0].forEach(h => { const th = document.createElement("th"); th.textContent = h.trim(); headerRow.appendChild(th); });
    thead.appendChild(headerRow);

    rows.slice(1).forEach(row => {
      const tr = document.createElement("tr");
      row.forEach(cell => { const td = document.createElement("td"); td.textContent = cell.trim(); tr.appendChild(td); });
      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    container.innerHTML = "";
    container.appendChild(table);
  } catch(err) {
    container.innerHTML = "<em>No materials list available.</em>";
    console.warn("Materials table load failed:", err);
  }
})();
</script>

</body>
</html>
